<!DOCTYPE html>
<html lang="nl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NovaWeb - Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link rel="stylesheet" href="login.css">
</head>

<body>
  <!-- Parallax sterrenlagen -->
  <div class="stars-deep" id="starsDeep"></div>
  <div class="stars-background" id="starsBackground"></div>

  <header>
    <div class="logo">
      <img src="Fotos/Logo.svg" alt="NovaWeb Logo" class="logo-img"
        onerror="this.style.display='none'; document.getElementById('logoFallback').style.display='flex';">
      <div id="logoFallback" class="logo-fallback" style="display: none;">NOVAWEB</div>
    </div>

    <nav>
      <a href="index.html">Home</a>
      <a href="over-ons.html">Over ons</a>
      <a href="projecten.html">Portfolio</a>
      <a href="diensten.html">Diensten</a>
      <a href="klantenProject.html">Mijn projecten</a>
    </nav>

    <div class="header-buttons">
      <a href="login.html" class="login-btn">Login</a>
      <a href="contact.html" class="contact-btn">Contact us</a>

      <!-- Chat icoon ge√Øntegreerd in de knopgroep -->
      <div class="chat-container">
        <img src="Fotos/chat.png" alt="Chat met ons" class="chat-icon" id="chatToggle">
      </div>
    </div>


    <!-- Chatvenster -->
    <div class="chat-box" id="chatBox">
      <div class="chat-header">
        <span>üí¨ Chat met NovaWeb</span>
        <button id="closeChat">√ó</button>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="message bot">Hoi! Hoe kunnen we je helpen vandaag? üòä</div>
      </div>
      <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="Typ een bericht..." />
        <button id="sendChat">Verstuur</button>
      </div>
    </div>

    <div class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>

  </header>

  <main>
    <!-- Login Sectie -->
    <section class="login-section">
      <div class="login-container">
        <!-- Floating elements -->
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>

        <!-- Login card -->
        <div class="login-card">
          <div class="login-header">
            <h1>Welkom Terug</h1>
            <p class="login-subtitle">Log in op je NovaWeb account</p>
          </div>

          <!-- Formulier -->
          <form class="login-form">
            <div class="form-group">
              <div class="input-container">
                <input type="email" id="email" required>
                <label for="email">E-mailadres</label>
              </div>
            </div>

            <div class="input-container password-container">
              <input type="password" id="password" required>
              <label for="password">Wachtwoord</label>
              <button type="button" class="toggle-password" aria-label="Toon wachtwoord">üêµ</button>
            </div>


            <button type="submit" class="login-submit-btn">
              <span class="btn-text">Inloggen</span>
              <div class="btn-loader" style="display:none;">
                <div class="loader"></div>
              </div>
            </button>

            <!-- Statusdiv voor Supabase login -->
            <div id="status" style="margin-top:10px; color:red;"></div>
          </form>

          <!-- Wachtwoord vergeten link buiten form -->
          <div class="form-options">
            <a href="resetww.html" class="forgot-password">Wachtwoord vergeten?</a>
          </div>

          <div class="login-divider">
            <span>of</span>
          </div>

          <div class="social-login">
            <div id="googleSignInDiv" class="social-btn google-btn"></div>

          </div>

          <div class="register-link">
            <p>Nog geen account? <a href="registreer.html">Registreer hier</a></p>
          </div>
        </div>

        <!-- Side panel -->
        <div class="login-side-panel">
          <div class="side-content">
            <h2>NovaWeb Platform</h2>
            <p>Beheer je projecten, bekijk statistieken en communiceer met ons team via ons beveiligde platform.</p>

            <div class="features-list">
              <div class="feature-item">
                <div class="feature-icon">üöÄ</div>
                <div class="feature-text">
                  <strong>Project Beheer</strong>
                  <p>Volg de voortgang van je website</p>
                </div>
              </div>

              <div class="feature-item">
                <div class="feature-icon">üìä</div>
                <div class="feature-text">
                  <strong>Live Statistieken</strong>
                  <p>Bekijk real-time analytics</p>
                </div>
              </div>

              <div class="feature-item">
                <div class="feature-icon">üí¨</div>
                <div class="feature-text">
                  <strong>Directe Communicatie</strong>
                  <p>Chat met ons development team</p>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>



  <!-- Supabase login script -->
  <script type="module" src="login.js"></script>
  <script src="common.js"></script>

  <script type="module" src="home.js"></script>

  <script>
    const nav = document.getElementById('navMenu');
    const headerButtons = document.querySelector('.header-buttons');
    const chatBox = document.getElementById('chatBox');
    const chatToggle = document.getElementById('chatToggle');
    const closeChat = document.getElementById('closeChat');

    function moveHeaderButtonsToNav() {
      // Verwijder oude clone als die er is
      const oldClone = document.querySelector('.nav-header-buttons');
      if (oldClone) oldClone.remove();

      if (window.innerWidth <= 768) {
        const clone = headerButtons.cloneNode(true);
        clone.classList.add('nav-header-buttons');

        // Stijl voor mobiel
        clone.style.display = 'flex';
        clone.style.flexDirection = 'column';
        clone.style.alignItems = 'center';
        clone.style.gap = '10px';
        clone.querySelectorAll('a, .chat-container').forEach(el => {
          el.style.width = '80%';
          el.style.textAlign = 'center';
          el.style.margin = '5px 0';
        });

        nav.appendChild(clone);

        // Voeg chat functionaliteit opnieuw toe voor gekloonde knop
        const clonedChat = clone.querySelector('.chat-container');
        if (clonedChat) {
          clonedChat.addEventListener('click', () => {
            chatBox.classList.toggle('active');
          });
        }
      }
    }

    // Bij laden en resize
    window.addEventListener('DOMContentLoaded', moveHeaderButtonsToNav);
    window.addEventListener('resize', moveHeaderButtonsToNav);

    // Hamburger menu toggle
    const hamburger = document.querySelector('.hamburger');
    hamburger.addEventListener('click', () => {
      nav.classList.toggle('active');
    });

    // Sluit chat knop
    closeChat.addEventListener('click', () => {
      chatBox.classList.remove('active');
    });

    // Event listener voor originele chat knop (desktop)
    chatToggle.addEventListener('click', () => {
      chatBox.classList.toggle('active');
    });

    const togglePassword = document.querySelector('.toggle-password');
    const passwordInput = document.getElementById('password');

    togglePassword.addEventListener('click', () => {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);

      // Optioneel: wissel het icoon tussen open en gesloten oog
      togglePassword.textContent = type === 'password' ? 'üêµ ' : 'üôà';
    });


  window.onload = function () {
    google.accounts.id.initialize({
      client_id: "605148728037-jc61t4rv1km9d1s40iqd2sdrltiqu4o6.apps.googleusercontent.com", // <-- vul hier jouw client ID in
      callback: handleCredentialResponse
    });

    google.accounts.id.renderButton(
      document.getElementById("googleSignInDiv"),
      {
        theme: "outline",
        size: "large",
        width: "100%"
      }
    );

    google.accounts.id.prompt(); // eventueel popup tonen
  };


  function handleCredentialResponse(response) {
    const data = parseJwt(response.credential);
    console.log("Google data:", data);

    // Toon gebruiker op de website (of sla op in localStorage)
    localStorage.setItem("user", JSON.stringify(data));

    alert(`Welkom ${data.name}! üëã`);

    // Redirect naar bv. de projectenpagina
    window.location.href = "klantenProject.html";
  }

  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
      atob(base64)
        .split('')
        .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
        .join('')
    );
    return JSON.parse(jsonPayload);
  }
fetch("/auth/google", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ credential: response.credential })
})
  .then(res => res.json())
  .then(data => {
    // Server bevestigt login
    localStorage.setItem("user", JSON.stringify(data.user));
    window.location.href = "klantenProject.html";
  })
  .catch(err => console.error("Login fout:", err));





  </script>
</body>

</html>