<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Mijn Projecten</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style>
        /* Import basis stijlen */
        @import url('home.css');

/* ===== ALGEMENE STIJLEN ===== */
html {
  scrollbar-width: none;
  -ms-overflow-style: none;
  scroll-behavior: smooth;
}

html::-webkit-scrollbar {
  display: none;
}

body {
  -ms-overflow-style: none;
  scrollbar-width: none;
  overflow-x: hidden;
  color: white;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  background: url('Fotos/wp3.jpg') no-repeat center center fixed !important;
  background-size: cover !important;
}

body::-webkit-scrollbar {
  display: none;
}

/* HEADER FIX */
body header {
  transition: transform 0.3s ease !important;
}

body header.hide {
  transform: translateY(-100%) !important;
}

/* PROJECTEN SECTIE STYLING */
.mijn-projecten {
  padding: 120px 20px 50px;
  min-height: 100vh;
  position: relative;
  max-width: 1400px;
  margin: 0 auto;
}

.mijn-projecten h2 {
  text-align: center;
  font-size: 3.5rem;
  margin-bottom: 60px;
  background: linear-gradient(135deg, #ffffff 0%, #ffd60a 50%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  background-size: 200% 200%;
  animation: gradientShift 3s ease-in-out infinite;
  font-weight: 800;
  position: relative;
}

.mijn-projecten h2::after {
  content: '';
  position: absolute;
  bottom: -15px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 3px;
  background: linear-gradient(45deg, #ffd60a, #ffed4e);
  border-radius: 2px;
}

@keyframes gradientShift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

/* PROJECT CARDS GRID */
.projects-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  gap: 30px;
  margin-top: 30px;
}

.project-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  padding: 30px;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.project-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 214, 10, 0.1), transparent);
  transition: left 0.6s ease;
}

.project-card:hover::before {
  left: 100%;
}

.project-card:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 214, 10, 0.3);
  transform: translateY(-10px);
  box-shadow: 0 20px 40px rgba(255, 214, 10, 0.15);
}

.project-card h3 {
  color: #ffd60a;
  margin-bottom: 15px;
  font-size: 1.6rem;
  font-weight: 700;
  line-height: 1.3;
}

.project-card p {
  margin-bottom: 20px;
  opacity: 0.9;
  line-height: 1.6;
  flex-grow: 1;
}

.project-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: #ffd60a;
  text-decoration: none;
  font-weight: 600;
  padding: 10px 0;
  transition: all 0.3s ease;
  border-bottom: 1px solid transparent;
  margin-bottom: 15px;
  align-self: flex-start;
}

.project-link:hover {
  color: #ffed4e;
  border-bottom: 1px solid #ffed4e;
  transform: translateX(5px);
}

.project-link::after {
  content: '↗';
  font-size: 1.2rem;
  transition: transform 0.3s ease;
}

.project-link:hover::after {
  transform: translate(3px, -3px);
}

.project-date {
  font-size: 0.9rem;
  opacity: 0.7;
  margin-top: auto;
  padding-top: 15px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

/* EMPTY STATE */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.empty-state h3 {
  color: #ffd60a;
  margin-bottom: 15px;
  font-size: 1.8rem;
}

.empty-state p {
  opacity: 0.9;
  font-size: 1.1rem;
  margin-bottom: 25px;
}

.add-project-btn {
  background: linear-gradient(45deg, #ffd60a, #ffed4e);
  color: #0d3b66;
  border: none;
  padding: 12px 30px;
  border-radius: 50px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-block;
}

.add-project-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(255, 214, 10, 0.3);
}

/* RESPONSIVE DESIGN */
@media (max-width: 1024px) {
  .mijn-projecten h2 { font-size: 3rem; }
  .projects-grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
}

@media (max-width: 768px) {
  .mijn-projecten { padding: 100px 15px 30px; }
  .mijn-projecten h2 { font-size: 2.5rem; }
  .projects-grid { grid-template-columns: 1fr; gap: 20px; }
  .project-card { padding: 25px; }
}

@media (max-width: 480px) {
  .mijn-projecten { padding: 80px 10px 20px; }
  .mijn-projecten h2 { font-size: 2rem; }
  .project-card { padding: 20px; }
}

/* ===== CHATWIDGET ===== */
.chat-container {
  display: flex;
  align-items: center;
  margin-left: 15px;
}

.chat-icon {
  width: 36px;
  height: 36px;
  cursor: pointer;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

.chat-icon:hover {
  transform: scale(1.1);
  opacity: 0.8;
}

.chat-box {
  position: fixed;
  top: 90px;
  right: 20px;
  width: 320px;
  height: 420px;
  background: #929292; /* donkergrijs voor de hele box */
  border-radius: 15px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transform: translateX(120%);
  opacity: 0;
  transition: all 0.4s ease;
  z-index: 9999;
}

.chat-box.active {
  transform: translateX(0);
  opacity: 1;
}

.chat-header {
  background: #0d3b66;
  color: white;
  font-weight: bold;
  padding: 12px 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chat-header button {
  background: none;
  border: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
}

.chat-messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background: #a4a4a4; /* lichte grijs voor berichtenlijst */
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.message {
  padding: 10px 14px;
  border-radius: 12px;
  max-width: 80%;
  font-size: 0.95rem;
}

/* Ontvangen berichten (van gebruiker) */
.message.bot {
  background: #5794d2; /* blauw */
  color: white;
  align-self: flex-start;
}

/* Verzonden berichten (van agent/jij) */
.message.user {
  background: #ffd60a; /* geel */
  color: #0d3b66; /* donkerblauw */
  align-self: flex-end;
}

/* Input area */
.chat-input-area {
  display: flex;
  border-top: 1px solid #ddd;
  padding: 10px;
  background: #ffffff;
}

.chat-input-area input {
  flex: 1;
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 8px 10px;
  font-size: 1rem;
  background: #dbdbdb;
  color: #000;
}

.chat-input-area button {
  background: #ffd60a;
  border: none;
  color: #0d3b66;
  font-weight: bold;
  border-radius: 10px;
  margin-left: 8px;
  padding: 8px 14px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.chat-input-area button:hover {
  background: #ffed4e;
}

    </style>
</head>

<body>

    <a href="#" class="logout-btn">Uitloggen</a>



    <header>
        <div class="logo">
            <img src="Fotos/Logo.svg" alt="NovaWeb Logo" class="logo-img"
                onerror="this.style.display='none'; document.getElementById('logoFallback').style.display='flex';">
            <div id="logoFallback" class="logo-fallback" style="display: none;">NOVAWEB</div>
        </div>

        <nav>
            <a href="index.html">Home</a>
            <a href="over-ons.html">Over ons</a>
            <a href="projecten.html">Portfolio</a>
            <a href="diensten.html">Diensten</a>
            <a href="klantenProject.html">Mijn projecten</a>
        </nav>

        <div class="header-buttons">
            <a href="login.html" class="login-btn">Login</a>
            <a href="contact.html" class="contact-btn">Contact us</a>

            <!-- Chat icoon geïntegreerd in de knopgroep -->
            <div class="chat-container">
                <img src="Fotos/chat.png" alt="Chat met ons" class="chat-icon" id="chatToggle">
            </div>

            <div class="chat-box" id="chatBox">
                <div class="chat-header">
                    <span>💬 Chat met NovaWeb</span>
                    <button id="closeChat">×</button>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot">Hoi! Hoe kunnen we je helpen vandaag? 😊</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="Typ een bericht..." />
                    <button id="sendChat">Verstuur</button>
                </div>
            </div>


            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>

    </header>
    <section class="mijn-projecten">
        <h2>Mijn Projecten</h2>
        <div id="project-list">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <p>Projecten worden geladen...</p>
            </div>
        </div>
    </section>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

// --- Supabase Config ---
const supabaseUrl = 'https://fmrvruyofieuhxmmrbux.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZtcnZydXlvZmlldWh4bW1yYnV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MDA0NTIsImV4cCI6MjA3NTQ3NjQ1Mn0.KooHvMATpbJqXmIkquvJcHVIqDo1G5ALWTiYVI7rlvg'
const supabase = createClient(supabaseUrl, supabaseKey)

// --- HTML Elements ---
const chatToggle = document.getElementById('chatToggle')
const chatBox = document.getElementById('chatBox')
const closeChat = document.getElementById('closeChat')
const chatInput = document.getElementById('chatInput')
const sendChat = document.getElementById('sendChat')
const chatMessages = document.getElementById('chatMessages')
const loginBtn = document.querySelector('.login-btn')
const logoutBtn = document.querySelector('.logout-btn')
const projectList = document.getElementById('project-list')
const hamburger = document.querySelector('.hamburger')
const nav = document.querySelector('nav')

let user = null

// ------------------ CHAT ------------------ //
function initChat() {
  const adminEmails = ['gallerstef@gmail.com', 'robinb@gmail.com']

  chatToggle.addEventListener('click', async () => {
    if (!user) {
      alert('Je moet inloggen om te chatten!')
      return
    }

    if (adminEmails.includes(user.email)) {
      window.location.href = 'admin.html'
      return
    }

    chatBox.classList.toggle('active')

    if (chatBox.classList.contains('active')) {
      await loadChatHistory()
    }
  })

  closeChat.addEventListener('click', () => chatBox.classList.remove('active'))
  sendChat.addEventListener('click', sendMessage)
  chatInput.addEventListener('keypress', e => e.key === 'Enter' && sendMessage())
}

// Laad oude berichten en toon ze
async function loadChatHistory() {
  chatMessages.innerHTML = ''
  const { data: messages, error } = await supabase
    .from('messages')
    .select('*')
    .order('created_at', { ascending: true })

  if (error) {
    console.error('Fout bij laden chatgeschiedenis:', error)
    appendMessage('bot', '⚠️ Er ging iets mis bij het laden van de chat.')
    return
  }

  if (!messages || messages.length === 0) {
    appendMessage('bot', 'Hoi! Hoe kunnen we je helpen vandaag? 😊')
    return
  }

  messages.forEach(msg => {
    const role = msg.user_id === user?.id ? 'user' : msg.role || 'bot'
    appendMessage(role, `${msg.email}: ${msg.message}`)
  })

  scrollChatToBottom()
}

// Verstuur bericht
async function sendMessage() {
  const tekst = chatInput.value.trim()
  if (!tekst) return
  if (!user) return alert('Je moet inloggen om te chatten!')

  appendMessage('user', `${user.email}: ${tekst}`)
  chatInput.value = ''
  scrollChatToBottom()

  const { error } = await supabase.from('messages').insert([
    { user_id: user.id, email: user.email, message: tekst, role: 'user' }
  ])
  if (error) console.error('Supabase fout:', error)
}

// Voeg bericht toe aan de chatbox
function appendMessage(role, text) {
  const msg = document.createElement('div')
  msg.className = `message ${role}`
  msg.textContent = text
  chatMessages.appendChild(msg)
}

// Scroll naar onder
function scrollChatToBottom() {
  chatMessages.scrollTop = chatMessages.scrollHeight
}

// ------------------ LOGIN + HEADER ------------------ //
async function checkLogin() {
  const { data: { session } } = await supabase.auth.getSession()
  user = session?.user ?? null
  return session
}

function updateHeader(session) {
  if (session) {
    loginBtn.innerText = 'Account'
    loginBtn.href = 'account.html'
  } else {
    loginBtn.innerText = 'Login'
    loginBtn.href = 'login.html'
  }
}

function initLogout() {
  logoutBtn.addEventListener('click', async e => {
    e.preventDefault()
    const { error } = await supabase.auth.signOut()
    if (error) alert('Uitloggen mislukt.')
    else window.location.href = 'login.html'
  })
}

// ------------------ PROJECTEN ------------------ //
async function loadProjects(userId) {
  if (!userId) {
    projectList.innerHTML = `
      <div class="empty-state">
        <h3>Nog geen projecten</h3>
        <p>Log in om je projecten te bekijken.</p>
      </div>`
    return
  }

  const { data: projects, error } = await supabase
    .from('projects')
    .select('*')
    .eq('user_id', userId)
    .order('created_at', { ascending: false })

  if (error) {
    projectList.innerHTML = `<div class="error-state"><h3>Er ging iets mis</h3><p>${error.message}</p></div>`
    return
  }

  if (!projects || projects.length === 0) {
    projectList.innerHTML = `<div class="empty-state"><h3>Nog geen projecten</h3></div>`
    return
  }

  projectList.innerHTML = `
    <div class="projects-grid">
      ${projects.map(p => `
        <div class="project-card">
          <h3>${p.title}</h3>
          <p>${p.description || 'Geen beschrijving.'}</p>
          ${p.link ? `<a href="${p.link}" class="project-link" target="_blank">Bekijk Project</a>` : ''}
          <div class="project-date">Aangemaakt op: ${new Date(p.created_at).toLocaleDateString('nl-NL')}</div>
        </div>`).join('')}
    </div>`
}

// ------------------ INITIALISATIE ------------------ //
window.addEventListener('load', async () => {
  initChat()
  const session = await checkLogin()
  updateHeader(session)
  initLogout()
  loadProjects(session?.user?.id)

  // Realtime chat updates voor alle nieuwe berichten
  supabase
    .channel('public:messages')
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
      const msg = payload.new
      // Toon berichten van iedereen, onderscheid bot/user
      const role = msg.user_id === user?.id ? 'user' : msg.role || 'bot'
      appendMessage(role, `${msg.email}: ${msg.message}`)
      scrollChatToBottom()
    })
    .subscribe()
})

// ------------------ HAMBURGER MENU ------------------ //
hamburger.addEventListener('click', () => nav.classList.toggle('active'))


</script>



</body>

</html>